{%extends "base.html"%}
{%block title%}{{msg.subject}}{%endblock%}
{%load pgfilters%}
{%block extrahead%}
<script type="text/javascript">
function onThreadSelect() {
   document.location.href = '/message-id/' + document.getElementById('thread_select').value;
}

$(function(){
   $('select#thread_select').selectmenu({
      style:'dropdown',
      escapeHtml:true,
      icons:[
         {find:'.hasatt', icon: 'ui-icon-document'},
      ]
   });
});
</script>
{%endblock%}
{%block contents%}
<h2>{{msg.subject}}</h2>
<table class="message">
 <tr>
  <th>From:</th>
  <td>{{msg.mailfrom|hidemail}}</td>
 </tr>
 <tr>
  <th>To:</th>
  <td>{{msg.to|hidemail}}</td>
 </tr>
{%if msg.cc%}
 <tr>
  <th>Cc:</th>
  <td>{{msg.cc|hidemail}}</td>
 </tr>
{%endif%}
 <tr>
  <th>Subject:</th>
  <td>{{msg.subject}}</td>
 </tr>
 <tr>
  <th>Date:</th>
  <td>{{msg.printdate}}</td>
 </tr>
 <tr>
  <th>Message-ID:</th>
  <td><a href="/message-id/{{msg.messageid|urlencode}}">{{msg.messageid}}</a> (view <a href="/message-id/raw/{{msg.messageid|urlencode}}">raw</a> or <a href="/message-id/flat/{{msg.messageid|urlencode}}">whole thread</a>)</td>
 </tr>
 <tr>
  <th>Thread:</th>
  <td>
   <select id="thread_select" onchange="onThreadSelect()">
{%for m in threadstruct%}{%if m.id%}<option value="{{m.messageid|urlencode}}"{%if m.id = msg.id%} selected="selected"{%endif%}{%if m.hasattachment%} class="hasatt"{%endif%}>{{m.indent|safe}}{{m.printdate}} from {{m.mailfrom|hidemail}}</option>{%endif%}
{%endfor%}
   </select>
  </td>
 </tr>
 <tr>
  <th>Lists:</th>
  <td>{%for l in lists %}<span class="listname"><a href="/list/{{l.listname}}/since/{{msg.shortdate}}">{{l.listname}}</a></span>{%endfor%}</td>
 </tr>
</table>
<div class="bodywrapper">
{%if msg.hiddenstatus%}
<pre>{{msg.hiddenreason}}</pre>
{%else%}
<pre>{{msg.bodytxt|hideallemail|urlize}}</pre>

{%if msg.has_attachment%}
{%for a in msg.attachments%}
{%if a.inlineable%}<a href="/message-id/attachment/{{a.id}}/{{a.filename}}"><img class="attachedimage" src="/message-id/attachment/{{a.id}}/{{a.filename}}" /></a>{%endif%}
{%if forloop.last%}<hr/>{%endif%}
{%endfor%}

{%for a in msg.attachments%}
<div>
<b>Attachment: <a href="/message-id/attachment/{{a.id}}/{{a.filename}}">{{a.filename}}</a></b><br/>
Description: {{a.contenttype}} ({{a.len|filesizeformat}}) {%if a.inlineable%}(inlined above){%endif%}
</div>
{%endfor%}
{%endif%}
{%if parent%}
<h3>In response to</h3>
<ul>
<li><a href="/message-id/{{parent.messageid|urlencode}}">{{parent.subject}}</a> at {{parent.printdate}} from {{parent.mailfrom|nameonly}}</li>
</ul>
{%endif%}
{%if responses %}
<h3>Responses</h3>
<ul>
{%for m in responses%}
<li><a href="/message-id/{{m.messageid|urlencode}}">{{m.subject}}</a> at {{m.printdate}} from {{m.mailfrom|nameonly}}</li>
{%endfor%}
</ul>
{%endif%}
{%if nextprev%}
{%for list, info in nextprev.items %}
<h3>{{list}} by date</h3>
<blockquote>
 <table border="0">
  {%if info.next%}
   <tr><td><a href="/message-id/{{info.next.msgid|urlencode}}">Next</a>:</td><td><b>From:</b> {{info.next.from|nameonly}}</td><td><b>Date:</b> {{info.next.date}}</td></tr>
   <tr><td></td><td colspan="2"><b>Subject</b>: {{info.next.subject}}</td></tr>
  {%endif%}
  {%if info.prev%}
   <tr><td><a href="/message-id/{{info.prev.msgid|urlencode}}">Previous</a>:</td><td><b>From</b>: {{info.prev.from|nameonly}}</td><td><b>Date</b>: {{info.prev.date}}</td></tr>
   <tr><td></td><td colspan="2"><b>Subject</b>: {{info.prev.subject}}</td></tr>
  {%endif%}
 </table>
</blockquote>
{%endfor%}
{%endif%}

{%endif%}{%comment%}hidden{%endcomment%}
</div>
{%endblock%}
